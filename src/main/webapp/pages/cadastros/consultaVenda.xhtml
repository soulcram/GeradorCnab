


<ui:composition template="/pages/cadastros/home.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
	<ui:define name="conteudo">
	
		<style type="text/css">
		    .product-item .product-item-content {
		        border: 1px solid var(--surface-d);
		        border-radius: 3px;
		        margin: .3rem;
		        text-align: center;
		        padding: 2rem 0;
		    }
		
		    .product-item .product-image {
		        width: 50%;
		        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)
		    }
		</style>
		
		<h:form id="form">
	
			
			
			<p:messages id="messages" showDetail="true" closable="true">
       			<p:autoUpdate/>
    		</p:messages>
    		
    		<p:panelGrid id="gridVendas" columns="1" layout="grid" rendered="#{!vendaController.editandoPedido}">
	    		
	    		<p:poll interval="2"  listener="#{vendaController.consultarVendas}" update="tabelaVendas" />
	    		<p:poll interval="2"  listener="#{vendaController.consultarAuto}" update="carrossel" />
				<p:panelGrid columns="4" layout="grid" contentStyleClass="p-align-baseline ui-fluid">
	
					<f:facet name="header">
	        			Consultar Vendas
	    			</f:facet>
					
					<p:outputLabel value="Telefone"></p:outputLabel>
					<p:column/>
					<p:column/>
					<p:column/>
					
					
					<p:inputText value="#{vendaController.telefone}"/>
					<p:commandButton action="#{vendaController.buscarPorTelefone}" update="form" icon="pi pi-plus" value="Adicionar Pedido"/>
					
					<p:column/>
					<p:column/>
	
				</p:panelGrid>
				
				<p:panelGrid id="carrossel" columns="1" layout="grid" rendered="#{vendaController.existePedidosEmAberto}">
				
				    
				        <p:carousel  value="#{vendaController.listaPedidosEmAberto}" var="item" numVisible="10" numScroll="1"  >
				            <f:facet name="header">
				            	<div align="left">
				                	<h5>Pedidos em Aberto</h5>
				                </div>
				            </f:facet>
				            <div class="product-item">
				                <div class="product-item-content">
				                    <div>
				                        <h3 class="p-mb-1">#{item.cliente.telefone}</h3>
				                        
				                        <h5 class="p-mb-1">#{item.cliente.nome}</h5>
				                       
				                        <div class="p-mt-5">
				                            <p:commandButton action="#{vendaController.atenderPedidoAberto(item)}" icon="pi pi-pencil" value="visualizar" update="form"/>
				                            <p:commandButton action="#{vendaController.cancelarPedidoAberto(item)}" icon="pi pi-trash" value="Cancelar" update="form"/>
				                        </div>
				                    </div>
				                </div>
				            </div>
				        </p:carousel>
				   
				</p:panelGrid>
				<div align="left">
					<p:panelGrid columns="1">
						
					</p:panelGrid>
				</div>
				
				<p:panelGrid columns="1">
					<p:dataTable id="tabelaVendas" var="item" value="#{vendaController.vendas}">
					
						<f:facet name="header">
							<div align="left">
				                <h5>Pedidos Aceitos</h5>
				            </div>
				       	</f:facet>
						
						<p:column headerText="Telefone">
							<h:outputText value="#{item.telefoneCliente}"/>
						</p:column>
						
						<p:column headerText="Nome">
							<h:outputText value="#{item.nomeCliente}" />
						</p:column>
						
						<p:column headerText="Endereço">
							<h:outputText value="#{item.logradouro} - #{item.numeroResidencia}"/>
						</p:column>
						
						<p:column headerText="Total Pedido">
							<h:outputText value="#{item.totalPedido}"/>
						</p:column>
						
						<p:column headerText="Status">
							<h:outputText value="#{item.status}"/>
						</p:column>
						
						<p:column headerText="Detalhes do Pedido">
							<div align="center">
								<p:commandButton action="#{vendaController.visualizar(item.idPedido)}"  value="visualizar"/>
							</div>
						</p:column>
					</p:dataTable>
				</p:panelGrid>
			</p:panelGrid>
			
			<p:panelGrid id="gridPedido" columns="1" layout="grid" rendered="#{vendaController.editandoPedido}">

				<f:facet name="header">
        			Novo Pedido
    			</f:facet>
    			
    			<p:panel id="clienteCadastrado" rendered="#{!vendaController.exibirCadastroCliente}">
    				<f:facet name="header">
        			Cliente
    				</f:facet>
    				<p:panelGrid columns="1" layout="grid">
	    				<p:outputLabel value="Telefone: #{vendaController.cliente.telefone}"/>
	    				<p:outputLabel value="Nome: #{vendaController.cliente.nome}"/>
	    				<p:outputLabel value="Endereço: #{vendaController.clienteEndereco.endereco.logradouro}"/>
	    				<p:outputLabel value="Numero: #{vendaController.clienteEndereco.numero}"/>
    				</p:panelGrid>
    				
    				<p:panelGrid>
						<p:commandButton action="#{vendaController.alterarDadosCliente}" update="form" value="Alterar" />
					</p:panelGrid>
    			</p:panel>
    			<p:panel id="cadastrarCliente" rendered="#{vendaController.exibirCadastroCliente}">
	    			<p:panel>
	    				<p:panelGrid columns="1" layout="grid">
	    					<f:facet name="header">
			        			Dados do Cliente
			    			</f:facet>
			    			
			    			<p:outputLabel value="Telefone"/>
							<p:inputText id="telefone" value="#{vendaController.cliente.telefone}"  >
							</p:inputText>
							<p:column/>
							
		    				<p:outputLabel value="Nome do Cliente"/>
							<p:inputText id="nome" value="#{vendaController.cliente.nome}" size="50" />
							<p:column/>
								
							<p:outputLabel value="Cpf"/>
							<p:inputMask id="cpf" value="#{vendaController.cliente.documento}" mask="999.999.999-99" autocomplete="false"/>
							<p:column/>
						</p:panelGrid>
	    			
	    			</p:panel>
	    			

	    			
	    			<p:panel>
    			
		    			<p:panelGrid columns="1" layout="grid" rendered="#{vendaController.adicionandoNovo}">
		    					<f:facet name="header">
				        			Adicionar Endereco do Cliente
				    			</f:facet>
				    			
				    			<p:outputLabel value="CEP"/>
								<p:inputMask id="cep" value="#{vendaController.clienteEndereco.endereco.cep}" mask="99999-999">
									<p:ajax event="change"  update="logradouro bairro cidade estado cep" listener="#{vendaController.buscarPorCep}" />
								</p:inputMask>
								<p:column/>
				    			
			    				<p:outputLabel value="Nome da rua"/>
								<p:inputText id="logradouro" value="#{vendaController.clienteEndereco.endereco.logradouro}" size="50">
									<p:ajax event="keydown"  update="idTbEndereco idEnderecoCliente bairro cidade estado cep" listener="#{vendaController.buscarPorLogradouro}" />
								</p:inputText>
								<p:column/>
								
								
								<p:panel id="idEnderecoCliente" >
									<p:dataTable id="idTbEndereco" var="item" value="#{vendaController.enderecos}" rendered="#{vendaController.consultandoEnd}" >
										    <p:column headerText="Cep">
										        <h:outputText value="#{item.cep}" />
										    </p:column>
										 
										    <p:column headerText="Rua">
										        <h:outputText value="#{item.logradouro}" />
										    </p:column>
										    
										    <p:column headerText="Bairro">
										        <h:outputText value="#{item.bairro}" />
										    </p:column>
										    
										    <p:column headerText="Cidade">
										        <h:outputText value="#{item.cidade}" />
										    </p:column>	
										    								    
										    <p:column headerText="Ação">
										        <p:commandButton action="#{vendaController.selecionarEndereco(item)}" update="form" value="Selecionar" />
										    </p:column>							    
									</p:dataTable>
									</p:panel>	
								
								
													
								<p:outputLabel value="Bairro"/>
								<p:inputText id="bairro"  value="#{vendaController.clienteEndereco.endereco.bairro}"/>
								<p:column/>
								
								<p:outputLabel value="Cidade"/>
								<p:inputText id="cidade"  value="#{vendaController.clienteEndereco.endereco.cidade}"/>
								<p:column/>
								
								<p:outputLabel value="Estado"></p:outputLabel>
								<p:selectOneMenu id="estado" value="#{vendaController.clienteEndereco.endereco.estado}">
						            <f:selectItem itemLabel="Selecione 1" itemValue="" />
						            <f:selectItems value="#{vendaController.estados}" />
						        </p:selectOneMenu>
								<p:column/>
								
								<p:outputLabel value="Numero da Residência"/>
								<p:inputText id="numRes"  value="#{vendaController.clienteEndereco.numero}"/>
								<p:column/>
								
								<p:outputLabel value="Complemento"/>
								<p:inputText id="compl"  value="#{vendaController.clienteEndereco.complemento}"/>
								<p:column/>
								<p:column/>
								<p:commandButton action="#{vendaController.adicionarEndereco}" value="Adiconar" update="form"/>
							</p:panelGrid>
    			
			    			<p:panelGrid columns="1" layout="grid">
			    			
			    				<p:commandButton action="#{vendaController.novoEndereco}" value="Novo" icon="pi pi-plus" update="form"/>
			    				<p:column/>
				    					<f:facet name="header">
						        			Endereco do Cliente
						    			</f:facet>
					    				<p:dataTable id="tabela" var="end" value="#{vendaController.cliente.clienteEnderecos}">
						    				
						    				
						    				<p:column headerText="CEP">
												<h:outputText value="#{end.endereco.cep}" />
											</p:column>
											
											<p:column headerText="Nome da rua">
												<h:outputText value="#{end.endereco.logradouro}" />
											</p:column>
											
											<p:column headerText="Bairro">
												<h:outputText value="#{end.endereco.bairro}" />
											</p:column>
											
											<p:column headerText="Numero da Residência">
												<h:outputText value="#{end.numero}" />
											</p:column>
											
											<p:column headerText="Complemento">
												<h:outputText value="#{end.complemento}" />
											</p:column>
											
											<p:column headerText="Alterar">
												<div align="center">
													<p:commandButton action="#{vendaController.alterarEndereco(end)}" icon="pi pi-pencil"  update="form"/>
												</div>
											</p:column>
											
											<p:column headerText="Excluir">
												<div align="center">
													<p:commandButton action="#{vendaController.excluirEndereco(end)}" icon="pi pi-trash" update="form"/>
												</div>
											</p:column>
											
											<p:column headerText="Selecionar">
												<div align="center">
													<p:commandButton action="#{vendaController.selecionarEndereco(end)}" icon="pi pi-trash" value="Selecionar" update="form"/>
												</div>
											</p:column>
											
					    				</p:dataTable>
			    				</p:panelGrid>
    				</p:panel>
					<p:panelGrid>
						<p:commandButton action="#{vendaController.salvarDadosCliente}" update="form" value="Salvar Dados do Cliente" />
					</p:panelGrid>
				</p:panel>
				<p:panel id="ultimoPedido">
					<f:facet name="header">
        			Último Pedido
    				</f:facet>
    				<p:panelGrid columns="3" layout="grid" rendered="#{vendaController.ultimoPedidoByCliente != null}">
    				
    					<p:outputLabel value="Data"/>
    					<p:outputLabel value="Valor Total"/>
    					<p:outputLabel value="Forma de Pagamento"/>
    					
    					<p:outputLabel value="#{vendaController.ultimoPedidoByCliente.data}"/>
    					<p:outputLabel value="#{vendaController.ultimoPedidoByCliente.valorTotal}"/>
    					<p:outputLabel value="#{vendaController.ultimoPedidoByCliente.formaPagamento}"/>
    					
    				</p:panelGrid>
    				<p:panelGrid columns="1" layout="grid" rendered="#{vendaController.ultimoPedidoByCliente != null}">
    					<p:dataTable var="item" value="#{vendaController.ultimoPedidoByCliente.produtos}">
							    <p:column headerText="Nome">
							        <h:outputText value="#{item.nome}" />
							    </p:column>
							 
							    <p:column headerText="Valor">
							        <p:inputNumber value="#{item.valor}"  symbol="R$ " symbolPosition="p" decimalSeparator="," thousandSeparator="." disabled="true"/>
							    </p:column>
							    
							    <p:column headerText="Quantidade">
							        <h:outputText value="#{item.quantidade}" />
							    </p:column>
							    
							    <p:column headerText="Sub Total">
							        <p:inputNumber value="#{item.subTotal}"  symbol="R$ " symbolPosition="p" decimalSeparator="," thousandSeparator="." disabled="true" />
							    </p:column>							    
						</p:dataTable>
					</p:panelGrid>
					<p:panelGrid columns="1" layout="grid" rendered="#{vendaController.ultimoPedidoByCliente == null}">
						<p:outputLabel value="Sem informações"/>
					</p:panelGrid>
				</p:panel>
				<p:panel id="produtosCadastrado">
    				<f:facet name="header">
        			Produtos
    				</f:facet>
    				<p:panelGrid columns="3" layout="grid">
	    				<p:panel>
	    					<f:facet name="header">
		        				<h:outputText value="#{vendaController.categoria1}" />
		    				</f:facet>
		    				<p:dataTable var="item" value="#{vendaController.tipoProduto1}">
							    <p:column headerText="Nome">
							        <h:outputText value="#{item.nome}" />
							    </p:column>
							 
							    <p:column headerText="Valor">
							        <p:inputNumber value="#{item.valor}"  symbol="R$ " symbolPosition="p" decimalSeparator="," thousandSeparator="." disabled="true"/>
							    </p:column>
							 
							    <p:column headerText="Adic. Ao Pedido">
							        <p:commandButton action="#{vendaController.adicionarAoPedido(item.idProduto)}"  value="+" update=":form:carrinho"/>
							    </p:column>
							</p:dataTable>
	    				</p:panel>
	    				<p:panel>
	    					<f:facet name="header">
		        				<h:outputText value="#{vendaController.categoria2}" />
		    				</f:facet>
		    				<p:dataTable var="item" value="#{vendaController.tipoProduto2}">
							    <p:column headerText="Nome">
							        <h:outputText value="#{item.nome}" />
							    </p:column>
							 
							    <p:column headerText="Valor">
							        <p:inputNumber value="#{item.valor}"  symbol="R$ " symbolPosition="p" decimalSeparator="," thousandSeparator="." disabled="true"/>
							    </p:column>
							 
							    <p:column headerText="Adic. Ao Pedido">
							        <p:commandButton action="#{vendaController.adicionarAoPedido(item.idProduto)}"  value="+" update=":form:carrinho"/>
							    </p:column>
							</p:dataTable>
	    				</p:panel>
	    				<p:panel>
	    					<f:facet name="header">
		        				<h:outputText value="#{vendaController.categoria3}" />
		    				</f:facet>
		    				<p:dataTable var="item" value="#{vendaController.tipoProduto3}">
							    <p:column headerText="Nome">
							        <h:outputText value="#{item.nome}" />
							    </p:column>
							 
							    <p:column headerText="Valor">
							        <p:inputNumber value="#{item.valor}"  symbol="R$ " symbolPosition="p" decimalSeparator="," thousandSeparator="." disabled="true"/>
							    </p:column>
							 
							    <p:column headerText="Adic. Ao Pedido">
							        <p:commandButton action="#{vendaController.adicionarAoPedido(item.idProduto)}"  value="+" update=":form:carrinho"/>
							    </p:column>
							</p:dataTable>
	    				</p:panel>
    				</p:panelGrid>
    			</p:panel>
    			<p:panel id="carrinho" >
    				<f:facet name="header">
        			Carrinho
    				</f:facet>
    				<p:panelGrid columns="2" layout="grid">
	    				<p:panel>
	    					<f:facet name="header">
		        			Produtos Selecionados
		    				</f:facet>
		    				<p:dataTable var="item" value="#{vendaController.pedido.produtos}">
							    <p:column headerText="Nome">
							        <h:outputText value="#{item.nome}" />
							    </p:column>
							 
							    <p:column headerText="Valor">
							        <p:inputNumber value="#{item.valor}"  symbol="R$ " symbolPosition="p" decimalSeparator="," thousandSeparator="." disabled="true"/>
							    </p:column>
							    
							    <p:column headerText="Quantidade">
							        <h:outputText value="#{item.quantidade}" />
							    </p:column>
							    
							    <p:column headerText="Sub Total">
							        <p:inputNumber value="#{item.subTotal}"  symbol="R$ " symbolPosition="p" decimalSeparator="," thousandSeparator="." disabled="true"/>
							    </p:column>
							 
							    <p:column headerText="Adic. Ao Pedido">
							    	<p:commandButton action="#{vendaController.diminuirQuantidade(item.idProduto)}"  value="-" update=":form:carrinho"/>
							        <p:commandButton action="#{vendaController.addQuantidade(item.idProduto)}"  value="+" update=":form:carrinho"/>
							    </p:column>
							    
							</p:dataTable>
	    				</p:panel>
	    				<p:panel id="idFormaPagamento">
	    					<f:facet name="header">
		        			Forma Pagamento
		    				</f:facet>
		    				<p:panelGrid columns="2" layout="grid">
		    					<p:outputLabel value="Valor do pedido"/>
								<p:inputNumber value="#{vendaController.pedido.valorTotal}"  symbol="R$ " symbolPosition="p" decimalSeparator="," thousandSeparator="." disabled="true"/>
								
								<p:outputLabel value="Taxa de entrega" rendered="#{vendaController.pedido.cobrarTaxa}"/>
								<p:inputNumber value="#{vendaController.pedido.taxaEntrega}" rendered="#{vendaController.pedido.cobrarTaxa}" symbol="R$ " symbolPosition="p" decimalSeparator="," thousandSeparator="." >
									<p:ajax event="change"  update="valorTotalPedido" listener="#{vendaController.atualizarTotalPedido}" />
								</p:inputNumber>
								
								<p:outputLabel value="Desconto" />
								<p:inputNumber value="#{vendaController.pedido.valorDesconto}" symbol="R$ " symbolPosition="p" decimalSeparator="," thousandSeparator="." >
									<p:ajax event="change"  update="valorTotalPedido" listener="#{vendaController.atualizarTotalPedido}" />
								</p:inputNumber>
								
								<p:outputLabel value="Valor Total do pedido"/>
								<p:inputNumber id="valorTotalPedido" value="#{vendaController.valorTotalPedido}"  symbol="R$ " symbolPosition="p" decimalSeparator="," thousandSeparator="." disabled="true"/>
								
								<p:outputLabel value="Entregador"/>
								<p:selectOneMenu id="entregador" value="#{vendaController.entregador}" converter="#{entregadorConverter}">
						            <f:selectItems value="#{vendaController.entregadores}" />
						            <p:ajax event="change"  update="idFormaPagamento" listener="#{vendaController.atualizarEntregador}" />
						        </p:selectOneMenu>
						        
						        <p:outputLabel value="Pagamento"/>
								<p:selectOneMenu id="pagamento" value="#{vendaController.pedido.formaPagamento}" effect="fold" editable="true">
						            <f:selectItems value="#{vendaController.formasDePagamentos}" />
						            <p:ajax event="change"  update="troco" listener="#{vendaController.calcularTroco}" />
						        </p:selectOneMenu>
						        
						        <p:outputLabel value="Troco"/>
								<p:inputNumber id="troco" value="#{vendaController.pedido.troco}"  symbol="R$ " symbolPosition="p" decimalSeparator="," thousandSeparator="." disabled="true"/>
								
								
							</p:panelGrid>
	    				</p:panel>
    				</p:panelGrid>
    			</p:panel>
    			
    			<p:outputLabel value="Observação"/>
				<h:inputText id="idObservacao" value="#{vendaController.pedido.observacao}" size="100"/>
				
				<p:panelGrid>
				<p:commandButton action="#{vendaController.cancelar}" value="Cancelar Pedido" update="form"/>
				<p:commandButton action="#{vendaController.voltarPedido}" value="Salvar e Voltar" update="form"/>
				<p:commandButton action="#{vendaController.salvar}" value="Finalizar Pedido" update="form"/>
				</p:panelGrid>
			</p:panelGrid>
			


		</h:form>
	</ui:define>
</ui:composition>